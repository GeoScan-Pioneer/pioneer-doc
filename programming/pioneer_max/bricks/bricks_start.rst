Начало работы в Bricks
=======================

.. contents:: Оглавление
   :depth: 2

.. important:: 
    Перед началом работы убедитесь, что находитесь с коптером в одной сети.

Открыть Pioneer Bricks можно двумя способами:
    * Открыть Pioneer Bricks  из `WebMenu`_
    * Ввести в адресной строке браузера "<ip адрес коптера>:2020"

    .. tip:: 
        Если вы подключены к wi-fi коптера, то следует ввести `10.0.0.31:2020 <http://10.0.0.31:2020/>`_
	
Интерфейс программы
~~~~~~~~~~~~~~~~~~~~    

Если вы всё сделали правильно, то увидите интерфейс Bricks в окне браузера.

.. image:: /_static/images/max-programming/bricks/full_interface.png
	:align: center

* Кнопка "Проект" в левой верхней части интерфейса отвечает за создание, сохранение и загрузку программ. 
* В левой части интерфейса находятся вкладки с блоками, разделённые по категориям.
* В правой верхней части интерфейса находятся кнопки для старта и остановки программы.
* В правой части интерфейса также находится окно отладки.

Создание, сохранение и открытие программы
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы создать новую программу, нажмите "Новый" во вкладке "Проект" в левой верхней части экрана.

.. image:: /_static/images/max-programming/bricks/new_project.png
	:align: center

Чтобы, сохранить созданную программу, нажмите "Сохранить" во вкладке "Проект",
затем введите название файла и нажмите "Ok".

.. image:: /_static/images/max-programming/bricks/save_project1.png
	:align: center


.. image:: /_static/images/max-programming/bricks/save_project2.png
	:align: center

Чтобы открыть сохранённую программу, нажмите "Открыть" во вкладке "Проект",
затем выберите название необходимой программы и нажмите на неё ЛКМ.

.. image:: /_static/images/max-programming/bricks/open_project.png
	:align: center

.. image:: /_static/images/max-programming/bricks/open_project2.png
	:align: center

Основы работы в Bricks
~~~~~~~~~~~~~~~~~~~~~~~

* Блоки программы выполняются сверху вниз;
* Чтобы добавить блок в программу, нужно перетащить его из соотвествующей вкладки на белое рабочее поле и присоеденить к предыдщему блоку;
* Для присоединения блока к предыдщему, поднесите его в нужное место программы, дождитесь появления тени и отпустите блок;
* Каждая программа должна начинаться с блока "Предвзлётная подготовка" из вкладки "События";
* Чтобы удалить блок, перенесите его из рабочего поля программы в левую часть интерфейса с категориями блоков;
* Также удалить или отключить блок можно нажав по нему ПКМ в рабочем поле программы;
* Перед запуском программы нужно убедиться, что ros-система запущена во вкладке ROS в `WebMenu`_ ;

Описание категорий и блоков для программирования
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В левой части интерфейса можно найти 14 вкладок-категорий с различными блоками для создания программы:

:ref:`category-text`, :ref:`category-logic`, :ref:`category-cicles`, :ref:`category-math`, :ref:`category-functions`, 
:ref:`category-vars`, :ref:`category-arrays`, :ref:`category-event`, :ref:`category-flight`, :ref:`category-bortinfo`, 
:ref:`category-sensors`, :ref:`category-modules`,  :ref:`category-logs`, :ref:`category-other`

.. tip:: Описание функционала каждого блока можно посмотреть, задержав на нём курсор мыши.

.. image:: /_static/images/max-programming/bricks/block_tip.png
	:align: center


.. _category-text:

Текст
""""""""""""""""
    В данном разделе находятся все блоки для создания, редактирования и прочей работы с текстом

.. _category-logic:

Логика
""""""""""""""""
    В данном разделе находятся блоки условий и логики, "если-то-иначе", логические операции и т.д.

.. _category-cicles:

Циклы
""""""""""""""""
    В данном разделе находятся блоки для работы с циклами.
    Repeat until, for, while.

.. _category-math:

Математика
""""""""""""""""
    В данном разделе находятся блоки для создания чисел и проведения математических операций с ними.
    Первый блок в разделе - число-константа.


.. _category-functions:

Функции
""""""""""""""""
    В данном разделе находятся блоки для создания функций.

.. _category-vars:

Переменные
""""""""""""""""
    В данном разделе находятся блоки для использования переменных. 
    Чтобы  создать переменную нажмите "Создать переменную и введите имя переменной", затем нажмите "Ок".
    Блоки для её использования появятся в разделе после создания.

    Чтобы удалить переменную, перетащите любой блок этой переменной в рабочее поле, нажмите на название переменной,
    затем "Удалить переменную"

.. _category-arrays:

Массивы
""""""""""""""""
    В данном разделе находятся блоки для создания, изменения и использования массивов данных.

.. _category-event:

События
""""""""""""""""
    В данном разделе находятся блоки запуска событий для "Пионера".

    Блок "Предвзлётная подготовка" обязателен в начале любой программы.

    Блоки "Взлёт" и "Посадка" соотвественно поднимают "Пионер" в воздух и сажают на землю.

.. _category-flight:

Полёт
""""""""""""""""
    В данном разделе находятся блоки для управления полётом: перемещение в заданные координаты и поворот вокруг своей оси (рысканье).

.. _category-bortinfo:

Бортовая информация
""""""""""""""""""""
    В данном разделе находятся блоки для получения бортовой информации о коптере.


.. _category-sensors:

Датчики
""""""""""""""""
    В данном разделе находятся блоки для получения информации с датчиков платы коптера.

.. _category-modules:

Модули
""""""""""""""""
    В данном разделе находятся блоки для работы с дополнительными модулями магнитного захвата и светодиодной матрицы, а также блоки для работы со светодиодами на плате "Пионера".


.. _category-logs:

Логи
""""""""""""""""
    В данном разделе находятся блоки, позволяющие получать логи программы.

.. _category-other:

Прочее
""""""""""""""""
    В данном разделе находятся блоки для использования камеры, а также перехода программы в сон на N секунд.


Запуск и остановка программы
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. important:: Перед запуском программы следует убедиться, что ROS система запущена.

Запустить ROS систему можно из `WebMenu`_  во вкладке ROS --> Управление ROS

Нажмите кнопку "Включить ROS систему".

.. image:: /_static/images/max-programming/bricks/ros_system_start.png
	:align: center

После запуска ROS системы кнопки  "Выключить ROS ядро" и "Выключить ROS систему" должны стать красными.

.. attention:: Если вы используете блок "Сделать фото" из раздела "Прочее", нужно также запустить сценарий camera_launch

Подробнее: :ref:`start-camera-launch`

Теперь, когда ROS система запущена, можно приступать к запуску программы.

Для того, чтобы запустить программу, нажмите кнопку "Вжух" в правой верхней части экрана.

.. image:: /_static/images/max-programming/bricks/vjuh.png
	:align: center

Если программа началась, во вкладке "Отладка" выведется сообщение "Начало программы".

Для того, чтобы остановить программу, нажмите кнопку "Стоп" в правой верхней части экрана.

.. image:: /_static/images/max-programming/bricks/stop.png
	:align: center

После остановки программы появится сообщение "Программа остановлено", нажмите "Ок".


.. _start-camera-launch:

Как запустить сценарий camera_launch
""""""""""""""""""""""""""""""""""""""

Для запуска сценария нужно воспользоваться `Web-терминалом`_ или `SSH`_.

Введите в терминал roslaunch gs_camera photo.launch -\-screen

.. _WebMenu: ../../../instructions/pioneer-max/first_launch/web_menu.html
.. _Web-терминалом: ../../../instructions/pioneer-max/first_launch/web_menu.html
.. _SSH: ../../../instructions/pioneer-max/first_launch/ssh.html
