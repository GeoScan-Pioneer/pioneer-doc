

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ru" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ru" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Lua документация по API &mdash; Документация Pioneer </title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="index" title="Алфавитный указатель" href="../../genindex.html" />
    <link rel="search" title="Поиск" href="../../search.html" />
    <link rel="next" title="Система навигации в помещении Геоскан Локус" href="../../indoor_nav.html" />
    <link rel="prev" title="Программирование на Lua" href="lua_main.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Содержание:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../const/const_main.html">Сборка «Пионера»</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../settings/settings_main.html">Настройки</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../flight/flight.html">Полет</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../module/module_main.html">Дополнительные модули</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../programming.html">Программирование</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../trik/trik_main.html">Визуальное программирование TRIK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pioneer_station/pioneer_station_main.html">Pioneer Station</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="lua_main.html">Программирование на Lua</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lua документация по API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">Описание API функций взаимодействия с автопилотом</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rgb">RGB светодиоды</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpio">GPIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#uart">UART</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spi">SPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Таймеры</a></li>
<li class="toctree-l4"><a class="reference internal" href="#outluaevent">События, отправляемые автопилоту</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Получение данных от автопилота</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Описание необходимых служебных функций скрипта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Пример скрипта</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Описание пинов разъемов модулей</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../indoor_nav.html">Система навигации в помещении Геоскан Локус</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pioneer</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../programming.html">Программирование</a> &raquo;</li>
        
          <li><a href="lua_main.html">Программирование на Lua</a> &raquo;</li>
        
      <li>Lua документация по API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/programming/lua/lua.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lua-api">
<h1>Lua документация по API<a class="headerlink" href="#lua-api" title="Ссылка на этот заголовок">¶</a></h1>
</div>
<div class="section" id="api">
<h1>Описание API функций взаимодействия с автопилотом<a class="headerlink" href="#api" title="Ссылка на этот заголовок">¶</a></h1>
<dl class="function">
<dt id="time">
<code class="descname">time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#time" title="Ссылка на это определение">¶</a></dt>
<dd><p>Возвращает время с момента включения коптера.</p>
</dd></dl>

<dl class="function">
<dt id="deltaTime">
<code class="descname">deltaTime</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deltaTime" title="Ссылка на это определение">¶</a></dt>
<dd><p>Возвращает разницу в секундах между временем коптера, которое можно получить функцией <a class="reference internal" href="#time" title="time"><code class="xref py py-func docutils literal notranslate"><span class="pre">time()</span></code></a>, и глобальным временем системы навигации.</p>
</dd></dl>

<dl class="function">
<dt id="launchTime">
<code class="descname">launchTime</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#launchTime" title="Ссылка на это определение">¶</a></dt>
<dd><p>Возвращает время запуска для системы навигации.</p>
</dd></dl>

<dl class="function">
<dt id="sleep">
<code class="descname">sleep</code><span class="sig-paren">(</span><em>seconds</em><span class="sig-paren">)</span><a class="headerlink" href="#sleep" title="Ссылка на это определение">¶</a></dt>
<dd><p>Останавливает выполнение скрипта на заданное время, допустимы дробные значения аргумента.
<strong>Рекомендуется использовать</strong> <a class="reference internal" href="#Timer" title="Timer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timer</span></code></a> <strong>, так как sleep блокирует дальнейшее выполнение скрипта.</strong></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>seconds</strong> – время сна в секундах.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="boardNumber">
<code class="descname">boardNumber</code><a class="headerlink" href="#boardNumber" title="Ссылка на это определение">¶</a></dt>
<dd><p>Получение идентификационного номера борта - доступно через переменную.</p>
</dd></dl>

<p><strong>Пример</strong></p>
<div class="code lua highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">boardNumber</span> <span class="o">=</span> <span class="n">boardNumber</span>
</pre></div>
</div>
<dl class="function">
<dt id="ap.push">
<code class="descclassname">ap.</code><code class="descname">push</code><span class="sig-paren">(</span><em>Event</em><span class="sig-paren">)</span><a class="headerlink" href="#ap.push" title="Ссылка на это определение">¶</a></dt>
<dd><p>Добавить событие автопилоту (см. <a class="reference internal" href="#outluaevent"><span class="std std-ref">События, отправляемые автопилоту</span></a>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>Event</strong> – номер события или название (например, <code class="docutils literal notranslate"><span class="pre">Ev.COPTER_LANDED</span></code>).</td>
</tr>
</tbody>
</table>
</dd></dl>

<p><strong>Пример</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">Ev</span><span class="p">.</span><span class="n">MCE_PREFLIGHT</span>
<span class="n">ap</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Ev</span><span class="p">.</span><span class="n">MCE_PREFLIGHT</span><span class="p">)</span>
</pre></div>
</div>
<dl class="function">
<dt id="ap.goToPoint">
<code class="descclassname">ap.</code><code class="descname">goToPoint</code><span class="sig-paren">(</span><em>latitude</em>, <em>longitude</em>, <em>altitude</em><span class="sig-paren">)</span><a class="headerlink" href="#ap.goToPoint" title="Ссылка на это определение">¶</a></dt>
<dd><blockquote>
<div>Для полёта с использованием GPS.</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>latitude</strong> – задается широта в градусах, умноженных на <span class="math notranslate nohighlight">\(10^{-7}\)</span>;</li>
<li><strong>longitude</strong> – задается долгота в градусах, умноженных на <span class="math notranslate nohighlight">\(10^{-7}\)</span>;</li>
<li><strong>altitude</strong> – задается высота в метрах.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Пример <cite>ap.goToPoint(600859810, 304206500, 50)</cite></p>
</dd></dl>

<dl class="function">
<dt id="ap.goToLocalPoint">
<code class="descclassname">ap.</code><code class="descname">goToLocalPoint</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>z</em>, <em>time</em><span class="sig-paren">)</span><a class="headerlink" href="#ap.goToLocalPoint" title="Ссылка на это определение">¶</a></dt>
<dd><p>Для полёта с использованием локальной системы координат.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>x</strong> – задается координата точки по оси <cite>x</cite>, в метрах;</li>
<li><strong>y</strong> – задается координата точки по оси <cite>y</cite>, в метрах;</li>
<li><strong>z</strong> – задается координата точки по оси <cite>z</cite>, в метрах;</li>
<li><strong>time</strong> – время, за которое коптер перейдет в следующую точку, в секундах. Если значение не указано, коптер стремится к точке с максимальной скоростью.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Пример  <code class="docutils literal notranslate"><span class="pre">ap.goToLocalPoint(1,</span> <span class="pre">1,</span> <span class="pre">1.2)</span></code> или <code class="docutils literal notranslate"><span class="pre">ap.goToLocalPoint(1,</span> <span class="pre">1,</span> <span class="pre">1.2,</span> <span class="pre">10)</span></code></p>
</dd></dl>

<dl class="function">
<dt id="ap.updateYaw">
<code class="descclassname">ap.</code><code class="descname">updateYaw</code><span class="sig-paren">(</span><em>angle</em><span class="sig-paren">)</span><a class="headerlink" href="#ap.updateYaw" title="Ссылка на это определение">¶</a></dt>
<dd><p>Установить рыскание.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>angle</strong> – угол в радианах.</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="rgb">
<h2>RGB светодиоды<a class="headerlink" href="#rgb" title="Ссылка на этот заголовок">¶</a></h2>
<dl class="class">
<dt id="Ledbar">
<em class="property">class </em><code class="descname">Ledbar</code><a class="headerlink" href="#Ledbar" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="Ledbar.new">
<code class="descname">new</code><span class="sig-paren">(</span><em>Count</em><span class="sig-paren">)</span><a class="headerlink" href="#Ledbar.new" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздать новый Ledbar с заданным количеством светодиодов.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>Count</strong> – количество светодиодов.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Ledbar.set">
<code class="descname">set</code><span class="sig-paren">(</span><em>self</em>, <em>num</em>, <em>r</em>, <em>g</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#Ledbar.set" title="Ссылка на это определение">¶</a></dt>
<dd><p>Установить цвет на конкретный светодиод.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>num</strong> – номер светодиода, нумеруются с 0 по 3 на плате, далее последовательно по подключенным модулям;</li>
<li><strong>r</strong> – интенсивность красной компоненты цвета в интервале от [0;1];</li>
<li><strong>g</strong> – интенсивность зеленой компоненты цвета в интервале от [0;1];</li>
<li><strong>b</strong> – интенсивность синей компоненты цвета в интервале от [0;1].</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>Смотри также <a class="reference internal" href="#fromHSV" title="fromHSV"><code class="xref py py-func docutils literal notranslate"><span class="pre">fromHSV()</span></code></a></p>
<p><strong>Пример</strong></p>
<p>К коптеру дополнительно подключен модуль с магнитом, на котором 4 RGB светодиода.</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">leds</span> <span class="o">=</span> <span class="n">Ledbar</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="kr">do</span>
    <span class="n">leds</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span> <span class="kr">do</span>
    <span class="n">leds</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="fromHSV">
<code class="descname">fromHSV</code><span class="sig-paren">(</span><em>hue</em>, <em>saturation</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#fromHSV" title="Ссылка на это определение">¶</a></dt>
<dd><p>Конвертирует представление цвета из HSV в RGB. Можно использовать для задания цвета светодиода.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first simple">
<li><strong>hue</strong> – задает цветовой тон. Варьируется в пределах [0;360];</li>
<li><strong>saturation</strong> – задает насыщенность. Варьируется в пределах [0;100];</li>
<li><strong>value</strong> – задает значение цвета. Варьируется в пределах [0;100];</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Результат:</th><td class="field-body"><p class="first last">Возвращает три компонеты цвета r, g, b.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="gpio">
<h2>GPIO<a class="headerlink" href="#gpio" title="Ссылка на этот заголовок">¶</a></h2>
<dl class="class">
<dt id="Gpio">
<em class="property">class </em><code class="descname">Gpio</code><a class="headerlink" href="#Gpio" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="Gpio.new">
<code class="descname">new</code><span class="sig-paren">(</span><em>Port</em>, <em>Pin</em>, <em>Mode</em><span class="sig-paren">)</span><a class="headerlink" href="#Gpio.new" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздать GPIO на порте с настройками.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>Port</strong> – Gpio.A; Gpio.B; … Gpio.E;</li>
<li><strong>Pin</strong> – номер пина на порте;</li>
<li><strong>Mode</strong> – Gpio.INPUT, Gpio.Output, Gpio.ALTFU.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Gpio.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#Gpio.read" title="Ссылка на это определение">¶</a></dt>
<dd><p>Получить значение.</p>
</dd></dl>

<dl class="method">
<dt id="Gpio.set">
<code class="descname">set</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#Gpio.set" title="Ссылка на это определение">¶</a></dt>
<dd><p>Установить значение в 1.</p>
</dd></dl>

<dl class="method">
<dt id="Gpio.reset">
<code class="descname">reset</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#Gpio.reset" title="Ссылка на это определение">¶</a></dt>
<dd><p>Установить значение в 0.</p>
</dd></dl>

<dl class="method">
<dt id="Gpio.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>self</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#Gpio.write" title="Ссылка на это определение">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>value</strong> – установить значение.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Gpio.setFunction">
<code class="descname">setFunction</code><span class="sig-paren">(</span><em>self</em>, <em>num</em><span class="sig-paren">)</span><a class="headerlink" href="#Gpio.setFunction" title="Ссылка на это определение">¶</a></dt>
<dd><p>Задать номер альтернативной функции.</p>
</dd></dl>

</dd></dl>

<p><strong>Пример</strong></p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">pin_name</span> <span class="o">=</span> <span class="n">Gpio</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">Gpio</span><span class="p">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Gpio</span><span class="p">.</span><span class="n">OUTPUT</span><span class="p">)</span>
<span class="n">pin_name</span><span class="p">:</span><span class="n">read</span><span class="p">()</span> <span class="c1">-- получить значение</span>
<span class="n">pin_name</span><span class="p">:</span><span class="n">set</span><span class="p">()</span> <span class="c1">-- установить значение 1</span>
<span class="n">pin_name</span><span class="p">:</span><span class="n">reset</span><span class="p">()</span> <span class="c1">-- установить значение 0</span>
<span class="n">pin_name</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="c1">-- установить значение true</span>
<span class="n">pin_name</span><span class="p">:</span><span class="n">setFunction</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">-- задать номер альтернативной функции</span>
</pre></div>
</div>
</div>
<div class="section" id="uart">
<h2>UART<a class="headerlink" href="#uart" title="Ссылка на этот заголовок">¶</a></h2>
<dl class="class">
<dt id="Uart">
<em class="property">class </em><code class="descname">Uart</code><a class="headerlink" href="#Uart" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="Uart.new">
<code class="descname">new</code><span class="sig-paren">(</span><em>num</em>, <em>rate</em>, <em>parity</em>, <em>stopBits</em><span class="sig-paren">)</span><a class="headerlink" href="#Uart.new" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздать Uart на порте с настройками.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>num</strong> – номер UART;</li>
<li><strong>rate</strong> – скорость;</li>
<li><strong>parity</strong> – Uart.PARITY_NONE, Uart.PARITY_EVEN, Uart.PARITY_ODD, необязательный параметр, по умолчанию Uart.PARITY_NONE;</li>
<li><strong>stopBits</strong> – Uart.ONE_STOP, Uart.TWO_STOP, необязательный параметр, по умолчанию Uart.ONE_STOP.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Uart.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>self</em>, <em>size</em><span class="sig-paren">)</span><a class="headerlink" href="#Uart.read" title="Ссылка на это определение">¶</a></dt>
<dd><p>Прочитать <code class="docutils literal notranslate"><span class="pre">size</span></code> байт.</p>
</dd></dl>

<dl class="method">
<dt id="Uart.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>self</em>, <em>data</em>, <em>size</em><span class="sig-paren">)</span><a class="headerlink" href="#Uart.write" title="Ссылка на это определение">¶</a></dt>
<dd><p>Записать данные (data) длиной (size).</p>
</dd></dl>

<dl class="method">
<dt id="Uart.bytesToRead">
<code class="descname">bytesToRead</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#Uart.bytesToRead" title="Ссылка на это определение">¶</a></dt>
<dd><p>Количество данных доступных для чтения.</p>
</dd></dl>

<dl class="method">
<dt id="Uart.setBaudRate">
<code class="descname">setBaudRate</code><span class="sig-paren">(</span><em>self</em>, <em>rate</em><span class="sig-paren">)</span><a class="headerlink" href="#Uart.setBaudRate" title="Ссылка на это определение">¶</a></dt>
<dd><p>Установить скорость.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>rate</strong> – скорость uart.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p><strong>Пример</strong></p>
<div class="code lua highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">uart</span> <span class="o">=</span> <span class="n">Uart</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">115200</span><span class="p">)</span>
<span class="n">uart</span><span class="p">:</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">-- прочитать 10 байт</span>
</pre></div>
</div>
</div>
<div class="section" id="spi">
<h2>SPI<a class="headerlink" href="#spi" title="Ссылка на этот заголовок">¶</a></h2>
<dl class="class">
<dt id="Spi">
<em class="property">class </em><code class="descname">Spi</code><a class="headerlink" href="#Spi" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="Spi.new">
<code class="descname">new</code><span class="sig-paren">(</span><em>num</em>, <em>rate</em>, <em>seq</em>, <em>mode</em><span class="sig-paren">)</span><a class="headerlink" href="#Spi.new" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздать Spi на порте с настройками.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>num</strong> – номер Spi</li>
<li><strong>rate</strong> – скорость</li>
<li><strong>seq</strong> – Spi.MSB, Spi.LSB, Spi.MSB_16, Spi.LSB_16, необязательный параметр, по умолчанию Spi.MSB;</li>
<li><strong>mode</strong> – Spi.MODE0, Spi.MODE1, Spi.MODE2, Spi.MODE3, необязательный параметр, по умолчанию Spi.MODE0.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Spi.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>self</em>, <em>size</em><span class="sig-paren">)</span><a class="headerlink" href="#Spi.read" title="Ссылка на это определение">¶</a></dt>
<dd><p>Прочитать <code class="docutils literal notranslate"><span class="pre">size</span></code> байт.</p>
</dd></dl>

<dl class="method">
<dt id="Spi.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>self</em>, <em>data</em>, <em>size</em><span class="sig-paren">)</span><a class="headerlink" href="#Spi.write" title="Ссылка на это определение">¶</a></dt>
<dd><p>Записать данные (data) длиной (size).</p>
</dd></dl>

<dl class="method">
<dt id="Spi.exchange">
<code class="descname">exchange</code><span class="sig-paren">(</span><em>self</em>, <em>data</em>, <em>size</em><span class="sig-paren">)</span><a class="headerlink" href="#Spi.exchange" title="Ссылка на это определение">¶</a></dt>
<dd><p>Записать данные (data) длиной (size) и прочитать size.</p>
</dd></dl>

</dd></dl>

<p><strong>Пример</strong></p>
<div class="code lua highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">spi</span> <span class="o">=</span> <span class="n">Spi</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
<span class="n">spi</span><span class="p">:</span><span class="n">exchange</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">-- записать данные (data) длиной (size) и прочитать size</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>Таймеры<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<dl class="class">
<dt id="Timer">
<em class="property">class </em><code class="descname">Timer</code><a class="headerlink" href="#Timer" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="Timer.new">
<code class="descname">new</code><span class="sig-paren">(</span><em>sec</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Timer.new" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздать новый Timer.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>sec</strong> – время интервала в секундах;</li>
<li><strong>func</strong> – функция, которая будет вызываться с заданным интервалом.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Timer.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#Timer.start" title="Ссылка на это определение">¶</a></dt>
<dd><p>Запуcкает таймер.</p>
</dd></dl>

<dl class="method">
<dt id="Timer.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#Timer.stop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Останавливает таймер. При этом остановка уже запущенного таймера произойдет после выполнения функции, стоящей в очереди на выполнение.</p>
</dd></dl>

<dl class="method">
<dt id="Timer.callAt">
<code class="descname">callAt</code><span class="sig-paren">(</span><em>local_time</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Timer.callAt" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздает и запускает новый Timer с функцией, которая будет вызвана один раз.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>local_time</strong> – локальное время (возвращаемое функцией <a class="reference internal" href="#time" title="time"><code class="xref py py-func docutils literal notranslate"><span class="pre">time()</span></code></a>), указывающее момент вызова функции;</li>
<li><strong>func</strong> – функция, которая будет вызвана.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Timer.callLater">
<code class="descname">callLater</code><span class="sig-paren">(</span><em>delay</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Timer.callLater" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздает и запускает новый Timer с функцией, которая будет вызвана один раз.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>delay</strong> – время, через которое будет вызвана функция;</li>
<li><strong>func</strong> – функция, которая будет вызвана.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Timer.callAtGlobal">
<code class="descname">callAtGlobal</code><span class="sig-paren">(</span><em>global_time</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Timer.callAtGlobal" title="Ссылка на это определение">¶</a></dt>
<dd><p>Cоздает и запускает новый Timer с функцией, которая будет вызвана один раз.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>global_time</strong> – глобальное время (<a class="reference internal" href="#time" title="time"><code class="xref py py-func docutils literal notranslate"><span class="pre">time()</span></code></a> + <a class="reference internal" href="#deltaTime" title="deltaTime"><code class="xref py py-func docutils literal notranslate"><span class="pre">deltaTime()</span></code></a>), указывающее момент вызова функции;</li>
<li><strong>func</strong> – функция, которая будет вызвана.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">При использовании функций <code class="xref py py-func docutils literal notranslate"><span class="pre">callAt()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">callLater()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">callAtGlobal()</span></code> следует обратить внимание,
что может быть не более 16 одновременно ожидающих таймеров. Если количество одновременно ожидающих таймеров больше 16, то новый таймер не будет создан.</p>
</div>
<p><strong>Пример</strong></p>
<p>Смотри <a class="reference internal" href="#example"><span class="std std-ref">Пример скрипта</span></a></p>
</div>
<div class="section" id="outluaevent">
<span id="id3"></span><h2>События, отправляемые автопилоту<a class="headerlink" href="#outluaevent" title="Ссылка на этот заголовок">¶</a></h2>
<p>События (events) представляются константами с префиксом «Ev.»</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Название</th>
<th class="head">Описание</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MCE_PREFLIGHT</td>
<td>Запустить двигатели и провести подготовку</td>
</tr>
<tr class="row-odd"><td>ENGINES_DISARM</td>
<td>Отключить двигатели</td>
</tr>
<tr class="row-even"><td>MCE_LANDING</td>
<td>Отправить на посадку</td>
</tr>
<tr class="row-odd"><td>MCE_TAKEOFF</td>
<td>Отправить на взлет</td>
</tr>
<tr class="row-even"><td>–устаревшие–</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>ENGINES_ARM</td>
<td>Завести двигатели</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id4">
<h1>Получение данных от автопилота<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h1>
<p>Для получение данных от автопилота используется класс Sensors</p>
<dl class="class">
<dt id="Sensors">
<em class="property">class </em><code class="descname">Sensors</code><a class="headerlink" href="#Sensors" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="Sensors.lpsPosition">
<code class="descname">lpsPosition</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.lpsPosition" title="Ссылка на это определение">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">x, y, z</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.lpsVelocity">
<code class="descname">lpsVelocity</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.lpsVelocity" title="Ссылка на это определение">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">vx, vy, vz</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.lpsYaw">
<code class="descname">lpsYaw</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.lpsYaw" title="Ссылка на это определение">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">yaw</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.orientation">
<code class="descname">orientation</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.orientation" title="Ссылка на это определение">¶</a></dt>
<dd><p>Данные положения.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">roll, pitch, azimuth</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.altitude">
<code class="descname">altitude</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.altitude" title="Ссылка на это определение">¶</a></dt>
<dd><p>Данные высоты по барометру.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">высота в метрах</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.range">
<code class="descname">range</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.range" title="Ссылка на это определение">¶</a></dt>
<dd><p>Данные c датчиков расстояния.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">Возвращает значения с датчика расстояния. Возвращает несколько значений.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.accel">
<code class="descname">accel</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.accel" title="Ссылка на это определение">¶</a></dt>
<dd><p>Данные c акселерометра.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">ax, ay, az</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.gyro">
<code class="descname">gyro</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.gyro" title="Ссылка на это определение">¶</a></dt>
<dd><p>Данные c гироскопа.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">gx, gy, gz</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Sensors.rc">
<code class="descname">rc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Sensors.rc" title="Ссылка на это определение">¶</a></dt>
<dd><p>Данные c пульта управления.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Результат:</th><td class="field-body">channel1, channel2, channel3, channel4, channel5, channel6, channel7, channel8</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p><strong>Примеры</strong></p>
<div class="code lua highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">lpsPosition</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">lpsPosition</span>
<span class="kd">local</span> <span class="n">lpsVelocity</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">lpsVelocity</span>
<span class="kd">local</span> <span class="n">lpsYaw</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">lpsYaw</span>
<span class="kd">local</span> <span class="n">orientation</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">orientation</span>
<span class="kd">local</span> <span class="n">range</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">range</span>
<span class="kd">local</span> <span class="n">accel</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">accel</span>
<span class="kd">local</span> <span class="n">gyro</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">gyro</span>
<span class="kd">local</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">Sensors</span><span class="p">.</span><span class="n">rc</span>

<span class="n">lpsX</span><span class="p">,</span> <span class="n">lpsY</span><span class="p">,</span> <span class="n">lpsZ</span> <span class="o">=</span> <span class="n">lpsPosition</span><span class="p">()</span>
<span class="n">lpsVelX</span><span class="p">,</span> <span class="n">lpsVelY</span><span class="p">,</span> <span class="n">lpsVelZ</span> <span class="o">=</span> <span class="n">lpsVelocity</span><span class="p">()</span>
<span class="n">yaw</span> <span class="o">=</span> <span class="n">lpsYaw</span><span class="p">()</span>

<span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">azimuth</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">()</span>

<span class="n">range1</span><span class="p">,</span> <span class="n">range2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span> <span class="n">range3</span> <span class="o">=</span> <span class="n">range</span><span class="p">()</span>

<span class="n">ax</span><span class="p">,</span> <span class="n">ay</span><span class="p">,</span> <span class="n">az</span> <span class="o">=</span> <span class="n">accel</span><span class="p">()</span>
<span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span> <span class="o">=</span> <span class="n">gyro</span><span class="p">()</span>
<span class="n">aileron</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ch8</span><span class="p">,</span> <span class="o">=</span> <span class="n">rc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h1>Описание необходимых служебных функций скрипта<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h1>
<div class="code lua highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">callback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="c1">-- Вызывается, когда приходят события от автопилота.</span>
<span class="kr">end</span>
</pre></div>
</div>
<p>Доступны следующие события, приходящие от автопилота:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Название</th>
<th class="head">Описание</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ENGINES_STARTED</td>
<td>Двигатели запущены</td>
</tr>
<tr class="row-odd"><td>COPTER_LANDED</td>
<td>Коптер совершил посадку</td>
</tr>
<tr class="row-even"><td>TAKEOFF_COMPLETE</td>
<td>Коптер достиг высоты взлета</td>
</tr>
<tr class="row-odd"><td>POINT_REACHED</td>
<td>Коптер достиг точки</td>
</tr>
<tr class="row-even"><td>POINT_DECELERATION</td>
<td>Коптер начал тормозить при подлёте к точке</td>
</tr>
<tr class="row-odd"><td>LOW_VOLTAGE1</td>
<td>Низкое напряжение аккумулятора, для возвращения домой</td>
</tr>
<tr class="row-even"><td>LOW_VOLTAGE2</td>
<td>Низкое напряжение аккумулятора, переходит в режим посадки</td>
</tr>
<tr class="row-odd"><td>SYNC_START</td>
<td>Получен сигнал синхронного старта от системы навигации</td>
</tr>
<tr class="row-even"><td>SHOCK</td>
<td>Столкновение или слишком сильные вибрации</td>
</tr>
<tr class="row-odd"><td>CONTROL_FAIL</td>
<td>Угол наклона коптера превысил допустимый</td>
</tr>
<tr class="row-even"><td>ENGINE_FAIL</td>
<td>Отказ двигателя</td>
</tr>
</tbody>
</table>
<p>„*“ событие Ev.ALTITUDE_REACHED ( коптер достиг высоты взлёта) начиная с версии АП 1.5.6173 более не используется.</p>
</div>
<div class="section" id="example">
<span id="id6"></span><h1>Пример скрипта<a class="headerlink" href="#example" title="Ссылка на этот заголовок">¶</a></h1>
<div class="code lua highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">boardNumber</span> <span class="o">=</span> <span class="n">boardNumber</span>
<span class="kd">local</span> <span class="n">unpack</span> <span class="o">=</span> <span class="nb">table.unpack</span>
<span class="kd">local</span> <span class="n">points</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">},</span>
        <span class="p">{</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span>  <span class="mf">0.2</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">{</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">local</span> <span class="n">curr_point</span> <span class="o">=</span> <span class="mi">1</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">nextPoint</span><span class="p">()</span>
    <span class="kr">if</span><span class="p">(</span><span class="o">#</span><span class="n">points</span> <span class="o">&gt;=</span> <span class="n">curr_point</span><span class="p">)</span> <span class="kr">then</span>
        <span class="n">ap</span><span class="p">.</span><span class="n">goToLocalPoint</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">curr_point</span><span class="p">]))</span>
        <span class="n">curr_point</span> <span class="o">=</span> <span class="n">curr_point</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">else</span>
        <span class="n">ap</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Ev</span><span class="p">.</span><span class="n">MCE_LANDING</span><span class="p">)</span>
    <span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nf">callback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="kr">if</span><span class="p">(</span><span class="n">event</span> <span class="o">==</span> <span class="n">Ev</span><span class="p">.</span><span class="n">TAKEOFF_COMPLETE</span><span class="p">)</span> <span class="kr">then</span>
        <span class="n">nextPoint</span><span class="p">()</span>
    <span class="kr">end</span>
    <span class="kr">if</span><span class="p">(</span><span class="n">event</span> <span class="o">==</span> <span class="n">Ev</span><span class="p">.</span><span class="n">POINT_REACHED</span><span class="p">)</span> <span class="kr">then</span>
        <span class="n">nextPoint</span><span class="p">()</span>
    <span class="kr">end</span>
<span class="kr">end</span>


<span class="kd">local</span> <span class="n">leds</span> <span class="o">=</span> <span class="n">Ledbar</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">blink</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">leds</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">timerBlink</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kr">function</span> <span class="p">()</span>
        <span class="kr">if</span><span class="p">(</span><span class="n">blink</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="kr">then</span>
            <span class="n">blink</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="kr">else</span>
            <span class="n">blink</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="kr">end</span>
        <span class="n">leds</span><span class="p">:</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">blink</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
<span class="n">timerBlink</span><span class="p">:</span><span class="n">start</span><span class="p">()</span>
<span class="n">ap</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Ev</span><span class="p">.</span><span class="n">MCE_PREFLIGHT</span><span class="p">)</span>
<span class="n">Timer</span><span class="p">.</span><span class="n">callLater</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span> <span class="n">ap</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">Ev</span><span class="p">.</span><span class="n">MCE_TAKEOFF</span><span class="p">)</span> <span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h1>Описание пинов разъемов модулей<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h1>
<p>Пины МК АП на <code class="docutils literal notranslate"><span class="pre">Pioneer_Base_v.1.0-v.1.1</span></code>, выведенные на внешние разъемы:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="37%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Разъем X1 (пин МК)</th>
<th class="head">Функция</th>
<th class="head">Описание</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Питание 5 В (только с АКБ)</td>
<td>Максимум 2 А</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Питание 3.3 В</td>
<td>Максимум 2 А</td>
</tr>
<tr class="row-even"><td>3 (PA12)</td>
<td>USART1_RTS</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4 (PA11)</td>
<td>USART1_CTS, TIM1_CH4</td>
<td>Module_OpenMV</td>
</tr>
<tr class="row-even"><td>5 (PA10)</td>
<td>USART1_RX, TIM1_CH3</td>
<td>Module_GPS, Module_USNav</td>
</tr>
<tr class="row-odd"><td>6 (PA9)</td>
<td>USART1_TX, TIM1_CH2</td>
<td>Module_GPS, Module_USNav</td>
</tr>
<tr class="row-even"><td>7 (PA15)</td>
<td>SPI3_NSS, TIM2_CH1</td>
<td>Module_GPS, Module_OpenMV</td>
</tr>
<tr class="row-odd"><td>8 (PC10)</td>
<td>SPI3_SCK</td>
<td>Module_GPS, Module_OpenMV</td>
</tr>
<tr class="row-even"><td>9 (PC11)</td>
<td>SPI3_MISO</td>
<td>Module_GPS, Module_OpenMV</td>
</tr>
<tr class="row-odd"><td>10 (PB5)</td>
<td>SPI3_MOSI, TIM3_CH2</td>
<td>Module_GPS, Module_OpenMV</td>
</tr>
<tr class="row-even"><td>11</td>
<td>Земля</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>12</td>
<td>Земля</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Разъем X2 (пин МК)</th>
<th class="head">Функция</th>
<th class="head">Описание</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Питание 5 В (только с АКБ)</td>
<td>Максимум 2 А</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Питание 3.3 В</td>
<td>Максимум 2 А</td>
</tr>
<tr class="row-even"><td>3 (PC2)</td>
<td>ADCx_IN12</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4 (PC3)</td>
<td>ADCx_IN13</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>5 (PA1)</td>
<td>ADCx_IN1, TIM2_CH2, TIM5_CH2</td>
<td>Module_Cargo (упр. магнитом)</td>
</tr>
<tr class="row-odd"><td>6 (PB7)</td>
<td>I2C1_SDA, TIM4_CH2</td>
<td>Module_ToF, Module_OpenMV</td>
</tr>
<tr class="row-even"><td>7 (PB6)</td>
<td>I2C1_SCL, TIM4_CH1</td>
<td>Module_ToF, Module_OpenMV</td>
</tr>
<tr class="row-odd"><td>8 (PA0)</td>
<td>DATA WS2812B</td>
<td>Уровень 5 В. Module_LED</td>
</tr>
<tr class="row-even"><td>9</td>
<td>Земля</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>Земля</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Для <code class="docutils literal notranslate"><span class="pre">Pioneer_Base_v.1.2</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="45%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Разъем X2 (пин МК)</th>
<th class="head">Функция</th>
<th class="head">Описание</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>3 (PA0)</td>
<td>USART4_TX, ADCx_IN0, TIM2_CH1, TIM5_CH1</td>
<td>Module_OpenMV</td>
</tr>
<tr class="row-odd"><td>4 (PA1)</td>
<td>USART4_RX, ADCx_IN1, TIM2_CH2, TIM5_CH2</td>
<td>Module_OpenMV</td>
</tr>
<tr class="row-even"><td>5 (PС3)</td>
<td>ADCx_IN13, SPI2_MOSI</td>
<td>Module_Cargo (упр. магнитом)</td>
</tr>
<tr class="row-odd"><td>8 (PC12)</td>
<td>DATA WS2812B</td>
<td>Уровень 5 В. Module_LED</td>
</tr>
</tbody>
</table>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../indoor_nav.html" class="btn btn-neutral float-right" title="Система навигации в помещении Геоскан Локус" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lua_main.html" class="btn btn-neutral" title="Программирование на Lua" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Geoscan LTD

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>