Agisoft Metashape
=================

Для создания 3D моделей существующих объектов отлично подходит
фотограмметрическая программа, разработанная компанией Геоскан – Agisoft
Metashape Standart. Надо отметить, что программа признана одной из
лучших для решения построения трёхмерных моделей на основе фотографий,
является универсальной и поставляется за рубеж уже в более 100 стран
нашего мира.

Agisoft Metashape — это передовое программное обеспечение, максимально
раскрывающее возможности фотограмметрии в совокупности с компьютерным
зрением. Metashape позволяет создавать высокодетализированные 3D модели
только по фотографиям, без использования дорогостоящего оборудования.

Возможность экспорта во все внешние пакеты для постобработки, например в

программу Autodesk 3Ds Max или в Autodesk Meshmixer, делает Agisoft
Metashape универсальным инструментом для 3D моделирования и её
последующей доработки.

Ядро Metashape – методы классической цифровой фотограмметрии,
подкреплённые современными алгоритмами компьютерного зрения. Слияние
этих технологий позволяет создать универсальную сканирующую систему,
которая может легко управляться даже новичком, а интуитивно понятный
интерфейс очень прост в освоении. Даже не обладая специальными знаниями,
вы можете получать высокоточные результаты практически без участия
оператора.

Если перед нами крошечная травинка или огромный утес – Metashape
способен воссоздать 3D модели предметов любых размеров в мельчайших
деталях. Вы можете отсканировать природный ландшафт или интерьер целого
здания для своего проекта.

Инструменты ретопологии и делайтинга позволят улучшить качество моделей
для создания визуальных эффектов, игр и дизайна. И всё, что для этого
нужно – только фотокамера нормального разрешения.

Надо отметить, что существует и профессиональное ответвление программы –
Agisoft Metashape Professional, которая позволяет обрабатывать
изображения, получаемые с помощью RGB- или мультиспектральных камер,
включая мультикамерные системы с БПЛА, преобразовывать снимки в плотные
облака точек, текстурированные полигональные модели, геопривязанные
ортофотопланы и цифровые модели рельефа/местности (ЦМР/ЦММ). Дальнейшая
постобработка позволяет удалять тени и искажения текстур с поверхности
моделей, рассчитывать вегетационные индексы и составлять файлы
предписаний для агротехнических мероприятий, автоматически
классифицировать плотные облака точек и т.д.

Для поиска общих точек Metashape использует алгоритм, который сначала
находит «особые» точки на отдельных фотографиях, а потом, на основе
уникальных идентификаторов – дескрипторов, точки отождествляются. Если
точка опознана на 2-ух и более кадрах она становится соответствием.

После этого следует выравнивание кадров, оно же – фототриангуляция. Этот
процесс реализован с помощью алгоритма Bundle Block Adjustment, в основе
которого лежит метод наименьших квадратов.

Bundle Block Adjustment – это интерпретация способа связок, который
является самым строгим способом решения фототриангуляции. В расчёт могут
быть включены координаты точек привязки (центров фотографирования или
опорных точек) и проекции маркеров на кадре. Всем параметрам можно
задать веса, т.е. масштаб их участия в расчёте.

Далее строится Плотное облако точек на основе карт глубины, для
построения которых, в свою очередь, используется алгоритм Semi-Global
Matching. Суть алгоритма заключается в том, что каждому пикселю левого
снимка стереопары находится соответствующий пиксель на правом снимке.
Каждый пиксель левого снимка сравнивается с поднабором («строкой»)
пикселей правого снимка с соответствующей ординатой. Далее формируется
куб (параллелепипед), для всего снимка, где каждому пикселю
соответствует одна «линия» ячеек, а строке пикселей на снимке
соответствует одно продольное сечение куба. Элементами куба являются
значения критерия соответствия, анализируя которые находят минимальные
значения для каждого пикселя.

Кроме того, анализируются связи между соседними пикселями по восьми
направлениям вокруг данного пикселя. В результате, для каждого пикселя
левого снимка находится соответствующее значение продольного параллакса
и, как следствие, пространственные координаты точек плотной модели (в
результате решения прямых засечек).

В этом курсе мы научимся с вами правильно использовать программу и
создавать трёхмерные модели на основе уже существующих объектов,
применяя при этом Agisoft Metashape Standart.

Для построения 3D-моделей в Agisoft Metashape Standart нам необходимы
фотографии, которые еще нужно должным образом получить. Для этого нужно
знать правило съёмки различных объектов. Для фасадов зданий — это одно
правило. Для объектов - другое. Рассмотрим их по - порядку:

Оборудование
~~~~~~~~~~~~

Необходимо использовать камеру с матрицей достаточно высокого разрешения
(5 МПикс и более). Благо сегодня, почти каждый смартфон уже оснащен
матрицей высокого разрешения, поэтому фотографии могут быть сделаны и на
мобильный телефон.

Примечание: избегайте сверхширококугольных объективов и объективов типа
"рыбий глаз".

Наилучшие результаты могут быть получены при помощи объективов с
фокусным расстоянием 50 мм (в 35 мм пленочном эквиваленте).
Рекомендуемые рамки изменения фокусного расстояния объективов от 20 до
80 мм (в 35 мм пленочном эквиваленте). Если съемка производилась камерой
с объективом "рыбий глаз", необходимо перед началом обработки задать
соответствующий тип камеры в настройках калибровки камеры Metashape.

Так же, рекомендуется использовать объективы с фиксированным фокусным
расстоянием. При использовании объективов с переменным фокусным
расстоянием, для получения более стабильных результатов, необходимо
зафиксировать одно из крайних значений фокусного расстояния
(максимальное или минимальное) на весь период съемки.

Существует так же основные правила, соблюдения которых поможет вам
максимально точно построить вашу 3D модель:

-  Фотографии должны иметь достаточно высокое разрешение (5 МПикс и
   более).

-  Широкоугольные объективы дают больше информации, чем телеобъективы;
   полученные с их помощью фотографии лучше подходят для нахождения
   соответствий между объектами на разных кадрах.

-  Планируйте сценарии съемки заранее.

-  При съемке избегайте плоских нетекстурированных, отражающих и
   прозрачных объектов.

-  Избегайте попадания в кадр нежелательных объектов на переднем плане.
   По возможности не допускайте изменения взаимного расположения
   объектов в процессе съемки.

-  На улице лучше производить съёмку в облачную погоду, так как
   фотографии могут получится с засветом или с бликами солнца.

-  Делайте снимки с большим перекрытием.

-  Наиболее важные детали рекомендуется снимать с 3 и более ракурсов.

-  Для привязки восстановленной трехмерной модели в относительной
   системе координат, необходимо запомнить или разместить в пределах
   сцены наземные маркеры, по которым будет построена относительная
   система координат и восстановлен масштаб. Измеряйте относительные
   расстояния.

-  Перед съемкой изучите приведенные ниже схемы и прочтите ограничения
   корректной работы программы.

Сценарии съемки
~~~~~~~~~~~~~~~

Рекомендуется заранее спланировать сценарий съемки, ведь подготовка к
работе - залог её успешного завершения. Тут тоже имеется несколько
важных правил, которые помогут вам максимально чётко и без потери
лишнего времени на перефотографирование получить снимки нужного
количества, качества и формата:

-  Избыток фотографий предпочтительнее, чем их недостаточное количество.

-  Количество "слепых зон" должно быть сведено к минимуму, так как
   Metashape может реконструировать только те точки сцены, которые видны
   как минимум на двух кадрах. В случае аэрофото перекрытие кадров может
   быть выражено в следующих цифрах: 60% поперечное перекрытие + 80%
   продольное перекрытие.

-  Необходимо эффективно использовать пространство кадра: снимаемый
   объект должен занимать наибольшую часть кадра. В некоторых случаях
   оптимальна портретная ориентация кадра.

-  Допускается съемка объекта по частям, при условии достаточного
   перекрытия кадров. Не обязательно помещать объект целиком в каждый
   кадр.

-  Применение хорошего освещения увеличит качество результата съемки.
   Однако необходимо избегать бликов. Источники освещения рекомендуется
   располагать за пределами кадра. Старайтесь не использовать вспышку.

-  Для выполнения измерений на модели необходимо перед съемкой
   расположить на поверхности объекта по крайней мере два маркера и
   измерить расстояние между ними (допускается просто расположить
   линейку известной длины в пределах сцены)

Существует несколько сценарий съемок, для различных объектов (или разной
величины).

Ниже приведен пример сценария съемки плоских объектов:

|image0|

Рисунок 1 - Съемка плоских объектов

Как показано на рисунке - 1, съёмку плоского объекта (фасада здания)
необходимо производить перпендикулярно самого объекта, без углов
поворота камеры. Примечательно, что расстояние от объекта до камеры, с
последующим фотографированием, должно быть примерно одинаковым. Также
необходимо правильно соблюдать перекрытие снимков, как продольное, так и
поперечное (60% поперечное перекрытие + 80% продольное перекрытие).
Исходя из размеров фотографируемого объекта должно получиться
достаточное количество фотографий, для последующей корректной обработки
данных.

|image1|

Рисунок 2 – данные съемки

На рисунке - 2 видно, что мы получили 50 фотографий данного особняка,
что вполне достаточно для получения 3D модели. Съемка произведена в
солнечный день, поэтому на фотографиях могут встречаться блики солнца
или тени здания. Такие фотографии лучше исключить из общего числа
фотографий. Рекомендуется снимать объект в дневное время, при этом в
облачную погоду.

Ниже приведен пример сценария круговой съёмки:

|image2|\ |image3|

Рисунок 3 – Круговая съемка объекта

Если же, мы хотим снять объект по окружности (например скульптуру или
памятник), фотографий хорошего разрешение (более 5Мп) должно быть
достаточно, для необходимого перекрытия каждой зоны порядка 30%. Иначе
программа может выдавать ошибку или выставлять неправильно камеры
съёмки. Исходя из размеров фотографируемого объекта должно получиться
достаточное количество фотографий, для последующей корректной обработки
данных. **В итоге, чем больше фотографий и выше их разрешение, тем
лучше.** Однако с повышением этих параметров возрастают требования к ПК,
обрабатывающий эти данные.

|image4|

Рисунок 4 – Результат круговой съемки

На рисунке - 4 видно, что съёмка куклы совершена по кругу самой фигуры,
при этом, важно соблюдать одинаковое расстояние от объекта до самой
камеры. Количество снимков куклы – 81. В данном случае, из-за размеров
фигуры, можно было сделать меньшее количество фотографий, чтобы избежать
долгого построения модели. Но если вы хотите сделать модель более точно,
используйте достаточное количество снимков.

Ниже приведен пример круговой съёмки интерьера:

|image5|

– Круговая съемка

|image6|

|image7|

|image8|

Рисунок 6 - Результат круговой съемки интерьера

На рисунке - 6 и видно, что съёмка аудитории совершена по кругу, то есть
позиции фотографируемого интерьера соответствуют рисунок - 5. В данном
случае мы решили воссоздать 3D модель интерьера помещения аудитории. Не
забываем соблюдать одинаковое расстояние от объекта до самой камеры.
Количество снимков – 44.

Обучение раскадровке видеоряда. Получение фотографий человека для
получения его модели.

Для получения модели человека используется описанная выше круговая
съёмка. Фотографий хорошего разрешение (более 5Мп) должно быть
достаточно, для необходимого перекрытия каждой зоны порядка 30%. То
есть, для более точной модели человека (прим. Лицо) необходимо от 30 до
50 фотографий.

|image9|\ |image10|

Рисунок 7 – Съемка изолированного объекта

Для примера, произведем полусферную съёмку лица человека для создания
его модели.

|image11|

Рисунок 8 – Результат полусферной съемки лица

У нас получилось 37 фотографий. Примечательно, что фотографии сделаны на
обычный смартфон с хорошей матрицей камеры (12 Мп). Важно, чтобы фон был
однородным, старайтесь избегать глянцевые поверхности и стеклянные
конструкции.

По исходным снимкам вы можете наблюдать, что съёмка совершена в два
круга (где лицо перпендикулярно камере и с верхней части головы). Это
создано для повышения точности модели и дабы избежать так называемых
«дыр» (места, где на камере не видны конкретные участки).

Примечание:

Настоятельно рекомендуем, при фотографировании объектов (пример модель
человека) использовать однородный задний фон, без попадания лишних
объектов, которые при дальнейшей обработке полученных снимков могут так
же быть построены в программе в автоматическом режиме. Если всё-таки
избежать этого не удалось, а фотографирование велось, например, на
улице, где множество внешних объектов попали на некоторые снимки, вы
можете наложить Маски. Об этом рассказано ниже.

Стоит также отметить, что с коптера проще получать видеоряд. Полученные
данные также можно обработать в Metashape. Версия Professional данной
программы сама способна обрабатывать видео. Если у Вас стоит иная
версия, то полученное видео можно пропустить через специальную
программу, которая сделает раскадровку с заданным количеством фотографий
на выходе.

Примером такой программы может послужить FreeVideo to GPEG Converter.
Данная программа интуитивно понятна, разберём её интерфейс на рисунке 9.

|image12|

Рисунок 9 – интерфейс ПО FreeVideo to GPEG Converter

Всё, что необходимо сделать:

-  Добавить видеофайл;

-  Выбрать необходимое количество кадров, как правило, пишется итоговое
   количество, например, 200. Но Вы можете выбрать и другие настройки из
   строки;

-  Выбрать путь сохранения полученных фотографий;

-  Нажать кнопку “конвертировать”.

Получение облака точек, плотного облака точек, полигональной модели, устранение изъянов и редактирование модели.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для создания моделей, описанных на прошлых уроках вам необходимо
вооружиться камерой с хорошим разрешением матрицы от 5мп и выше (можно
использовать фотокамеру на смартфоне, если она удовлетворяет
характеристикам и формату вывода изображений (JPEG, TIFF, DNG, PNG,
OpenEXR, BMP, TARGA, PPM, PGM, SEQ, ARA)) и установленную на ПО Agisoft
Metashape. Обратите внимание, если у вас установлена Демо-версия
программы, то сохранить полученные результаты не представляется
возможным.

Для загрузки набора фотографий:

-  Выберите пункт “Добавить фотографии” в меню Обработка (или нажмите
   кнопку

-  “Добавить фотографии” на панели “Проект”) (рисунок - 10);

-  В появившемся диалоговом окне выберите нужную папку с фотографиями и
   укажите

-  конкретные файлы. Нажмите кнопку “Открыть”;

-  Выбранные фотографии появятся на панели “Проект”.

|image13|

Рисунок 10 – Вкладка Проект

Наложение масок.
~~~~~~~~~~~~~~~~

Для достижения наилучших результатов реконструкции, программа Metashape
предоставляет возможность закрыть маской все второстепенные объекты на
исходных фотографиях (фон, поворотный стол и т. д.).

|image14|

Рисунок 11 – Применение масок

Дважды кликните по фотографии, предназначенной для редактирования, на
панели “Фотографии”, чтобы открыть ее в рабочей области.

Выберите один из инструментов выделения на главной панели
инструментов\ *:*

-  |image15| **Прямоугольное выделение** *для* незначимых элементов
   прямоугольной формы;

-  |image16| **Выделение контура** – для выделения фигур произвольной
   формы;

-  |image17| **Выделение области** – для обрисовки области выделения при
   помощи мыши.

Для выделения однородного фона используйте инструмент |image18|

**“Выделение связных областей”.**

Выберите инструмент |image19| **“Выделение связных областей”** на панели
инструментов, затем кликните внутри области, предназначенной для
выделения. Для добавления смежных областей в выделенную область,
кликните внутри области, которую надо добавить в выделение, удерживая
клавишу **Ctrl**.

Сохраните маску, нажав кнопку |image20| **Добавить выделение** на панели
инструментов.

Для изменения конфигурации маски используйте кнопки |image21|
**Инвертировать выделение** / |image22| **Вычесть выделение** на панели
инструментов.

Повторите описанную процедуру для каждой фотографии, для которой
необходимо наложение маски на второстепенные элементы изображения.

Области, закрытые маской, могут быть проигнорированы на этапе обработки
**“Выровнять фотографии”** (для этого подключите опцию “\ **Использовать
маску для фильтрации соответствий”** в диалоговом окне **“Выровнять
фотографии”**) и всегда игнорируются на этапах **“Построить плотное
облако”** и **“Построить текстуру”**.

Выравнивание фотографий

После того как фотографии были загружены в Metashape, необходимо
определить положение и ориентацию камеры для каждого кадра и построить
разреженное облако точек. Эти операции выполняются в Metashape на этапе
выравнивания.

Для выравнивания набора фотографий

1. Выберите пункт “Выровнять фотографии…” в меню Обработка (рисунок -
   12)

|image23|

Рисунок 12 – Меню Обработка

1. В появившемся диалоговом окне выберите предпочтительные параметры
   выравнивания. Чтобы модель была сформирована максимально корректно
   рекомендуется выбрать точность от среднего. Обратите внимание,
   Высокая точность позволяет получить наиболее достоверное положение
   камеры, тогда как низкая точность может быть использована для грубого
   расчета положения камеры в кратчайшее время. Остальные параметры
   оставляем без изменений. Нажмите ОК, когда выбор сделан.

После выполнения процедуры выравнивания фотографий, мы можем наблюдать,
как во вкладке “Фотографии” над каждым конкретным снимком стоит зелёная
галочка. Это означает, что выравнивание выполнено корректно (рисунок -
13).

|image24|

Рисунок 13 – Выравнивание снимков

Уже на данном этапе мы видим, как программа упорядочила наши снимки и
сформировала модель камер, относительно сделанных снимков и расстояния
от камеры до этих снимков.

Также мы можем беспрепятственно вращать нашу модель для оценки
промежуточного качества выравнивания и дальнейших выполненных процедур
кнопкой “Навигация” в панели “Инструменты”, наведя курсор и нажимая на
“Сферу модели” (рисунок 14).

|image25|

Рисунок 14 – Вращение модели

На рисунке 14 видим, что все фотографии камеры успешно выровнялись.

Построение плотного облака точек
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Metashape позволяет создавать и отображать плотное облако точек.
Основываясь на рассчитанных положениях камер, программа вычисляет карты
глубины для каждой камеры и на их основе строит плотное облако точек.
Metashape как правило генерирует очень плотные облака точек: такие же
плотные (если не плотнее) как облака точек LIDAR. Плотное облако точек
может быть отредактировано и классифицировано при помощи Metashape, а
также использовано для построения полигональной модели, карты высот или
тайловой модели. Наконец, плотное облако может быть экспортировано для
дальнейшего анализа в других приложениях.

Для построения плотного облака точек:

1. Выберите пункт “Построить плотное облако…” в меню “Обработка”.

|image26|

Рисунок 15 – Пункт Построить плотное облако

1. В диалоговом окне “Построить плотное облако” установите необходимые
   параметры реконструкции. Также, как и в пункте “Выравнивания”,
   качество построения плотного облака точек зависит от времени его
   значения. Высокое качество позволяет получить наиболее достоверный
   расчёт плотного облака, тогда как низкая качество может быть
   использована для грубого построения в кратчайшее время.

Кроме того, возможно использование следующих дополнительных параметров.

Режимы Фильтрации карт глубины
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

На стадии построения плотного облака точек Metashape рассчитывает карты
глубины для каждого изображения. В случае, если текстура некоторых
элементов сцены плохо выражена, или изображение нечетко сфокусировано, а
также вследствие цифрового шума, некоторые точки могут быть неправильно
позиционированы. Для фильтрации выбросов Metashape имеет несколько
встроенных алгоритмов, которые могут применяться в зависимости от задач
конкретного проекта.

Мягкая

При сложной, с многочисленными мелкими деталями на переднем плане,
геометрии реконструируемой сцены, рекомендуется выбрать для параметра
Фильтрация карт глубины значение “Мягкая”. В этом случае важные элементы
сцены не будут исключены из построения. Мягкий режим фильтрации карт
глубины может быть также полезен при обработке аэрофотоснимков, если
область исследования содержит плохо текстурированные поверхности
(например, крыши зданий).

Агрессивная

При реконструкции области без значимых мелких деталей, рекомендована к
применению “Агрессивная” фильтрация карт глубины, чтобы исключить
максимальное число ошибочно позиционированных точек. Данное значение
параметра обычно рекомендовано для обработки аэрофотоснимков, однако в
некоторых проектах (см. комментарий для случая выше) может применяться
“Мягкая фильтрация”.

Умеренная

При использовании режима фильтрации карт глубины “Умеренная”, параметры
фильтрации устанавливаются на уровне, среднем между режимами “Мягкая” и
“Агрессивная”. С настройками можно экспериментировать, в случае
сомнений, какой из режимов фильтрации следует применить. Кроме того,
фильтрация карт глубины может быть “Отключена”. Однако использование
такого сценария не рекомендовано, так как он ведет к сильному увеличению
"шума" в плотном облаке точек.

После выполнения процедуры “Построения плотного облака точек” в
диалоговом окне нажимаем на значок “Плотное облако” (рисунок 16) и
видим, как программа в режиме плотного облака достроила необходимые
точки для построение полигональной модели.

|image27|

Рисунок 16 – режим Плотного облака

Редактирование полученного облака точек.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

На этапе построения облака точек можем наблюдать, что программа в
автоматическом режиме захватила и достроила не нужную нам часть белого
фона. Чтобы при дальнейшей обработке программа не считывала ненужные нам
части фона (или объектов) инструментом “Прямоугольного выделения”,
выделяем такую область и кнопкой delete на клавиатуре эти области
удаляем (рисунок - 17 и рисунок - 18).

Главное, не увлекаться данным инструментом выделения, так как если вы
удалите область облака точек самой модели, в дальнейшем она построиться
без учёта того облака.

|image28|

Рисунок 17 – Процесс удаления фона

|image29|

Рисунок 18 – Процесс удаления фона

Получение полигональной модели.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

После редактирования плотного облака переходим к построение
полигональной модели.

1. Выберите пункт “Построить модель…” в меню “Обработка”.

2. В диалоговом окне “Построить модель” установите необходимые параметры
   “Реконструкции” (рисунок - 19) и нажмите ОК

\ |image30|

Рисунок 19 – Окно Построить модель

Параметры реконструкции
~~~~~~~~~~~~~~~~~~~~~~~

Metashape поддерживает несколько методов восстановления трехмерной
полигональной модели и предоставляет ряд настроек, позволяющих выполнить
оптимальную реконструкцию для конкретного набора фотографий.

Тип поверхности

Произвольный тип поверхности может быть использован для моделирования
объектов любого вида. Этот тип следует выбирать для реконструкции
замкнутых поверхностей, таких как статуи, здания и т. д. Соответствующие
методы реконструкции не подразумевают никаких ограничений типов
моделируемых объектов, что достигается за счет использования большего
количества ресурсов памяти.

Методы, определяемые типом поверхности Карта высот, оптимизированы для
моделирования плоских поверхностей, таких как ландшафт или барельефы.
Этот тип объекта следует выбирать при обработке результатов
аэрофотосъемки, поскольку соответствующие методы требуют меньшего
количества ресурсов памяти, и, следовательно, позволяют обрабатывать
большее число изображений.

Исходные данные

Данный параметр определяет источник данных для построения трехмерной
полигональной модели. Значение параметра Разреженное облако может быть
использовано для быстрого создания полигональной модели на основании
только разреженного облака точек. Настройка параметра Плотное облако
позволит построить полигональную модель высокого качества, основываясь
на заранее восстановленном плотном облаке точек, однако время обработки
увеличится.

Количество полигонов

Устанавливает максимальное число полигонов в итоговой трехмерной
полигональной модели. Предложенные значения для параметра (Высокое,
Среднее, Низкое) рассчитаны на основании числа точек в предварительно
созданном плотном облаке: отношение равно 1/5, 1/15, и 1/45
соответственно. Эти значения отражают оптимальное количество полигонов
для модели соответствующей детализации.

Пользователь может самостоятельно задать желаемое число полигонов в
итоговой модели (Пользовательское значение параметра). Обратите
внимание, что слишком маленькое число полигонов ведет к построению
грубой модели, тогда как слишком большое их число (более 10 миллионов
полигонов) скорее всего создаст сложности при визуализации модели во
внешних программах.

Кроме того, возможна настройка следующих дополнительных параметров.

Интерполяция

Режим интерполяции Отключена подразумевает точную реконструкцию, так,
как только области, заданные в плотном облаке точек, будут
восстановлены. Обычно этот режим требует заполнения отверстий вручную на
стадии постобработки. При выбранном режиме интерполяции Включена (по
умолчанию), Metashape интерполирует информацию о каждой точке плотного
облака на поверхность круга определенного радиуса. Таким образом
некоторые отверстия могут быть заполнены автоматически, а оставшиеся
отверстия потребуют заполнения на стадии постобработки.

В режиме Экстраполированная Metashape создает полигональную модель без
отверстий с экстраполированной геометрией. Данный режим допускает
генерирование больших дополнительных областей, однако они могут быть
легко удалены вручную.

Рассчитывать цвета вершин
~~~~~~~~~~~~~~~~~~~~~~~~~

Если в исходных данных присутствует информация о цвете точек, текущая
опция позволит рассчитать цвета вершин полигональной модели, если это
необходимо (в соответствии с выбором пользователя).

После построения полигональной модели видим, что программа, посредством
достраивания, на основе плотного облака сформировала непрерывные
полигоны однородной модели: затенённого (рисунок - 20), сплошного
(рисунок - 21), и каркасного (рисунок - 22) (треугольного) типов.

|image31|

Рисунок 20 – Затенённый тип

|image32|

Рисунок 21 – Сплошной тип

|image33|

Рисунок 22 – Каркасный тип

На этапе получения полигональной модели мы также можем удалить лишние
части построенной модели (или фона) инструментом прямоугольного
выделения и кнопкой Delete на клавиатуре, описанного в занятии 28, для
получения нужного результата.

Полученную модель мы можем легко экспортировать в формате STL или других
предложенных программой форматах для дальнейшего редактирования.

В общем меню нажмите “Файл – Экспорт – Экспорт модели” (рисунок - 23).

|image34|

Рисунок 23 – Экспорт модели

Выберите нужный формат для экспортирования и назовите её для дальнейшего
сохранения.

После получения модели в формате STL или OBJ Вы можете экспортировать её
в редактор моделей, например, Autodesk Meshmixer.

Как только модель загружена, её нужно целиком выделить комбинацией
клавиш “Ctrl+A”. Во вкладке “Deform” выбрать “Transform” или нажать
горячую клавишу T. Далее, необходимо “вытянуть” наверх модель в рабочую
область моделирования (потянув за зелёную стрелку по оси Z). Если
необходимо, то можно модель повернуть, нажав на область между стрелками
(рисунки - 24, 25, 26).

\ |image35|

Рисунок 24 - работа в MeshMixer

\ |image36|

Рисунок 25 - работа в MeshMixer

\ |image37|

Рисунок 26 - работа в MeshMixer

Чтобы убрать с поверхности мелкие артефакты, можно воспользоваться двумя
методами.

Первый метод - использование специальных “кистей”. Заходим в раздел
“Sculpt”, выбираем “Brushes” и подбираем необходимую кисть. В данном
случае мы должны убрать выпуклые артефакты, поэтому выбираем кисть,
которая сглаживает поверхность. Однако, в некоторых случая необходим
инструмент, вытягивающий полигоны наружу. На рисунке 27 и рисунке - 28
виден процесс “до” и “после” применения этого инструмента.

\ |image38|

Рисунок 27 – до применения “Кисти”

\ |image39|

Рисунок 28 – после применения “Кисти”

Второй метод несколько кардинальнее, пользоваться им надо с
осторожностью, так как программа достраивает модель в соответствии с
кривизной контура. Сначала необходимо выбрать полигоны, которые мы хотим
обработать с помощью инструмента “Select”, нажимаем кнопку “Delete”,
наводим курсор мыши точно на полученный контур и жмём два раза левой
кнопкой мыши. После этого, во вкладке “Edit” выбираем “Erase and Fill” и
проверяем результат. Процесс показан на цикле изображений ниже (рисунки
- 29, 30, 31, 32, 33).

\ |image40|

Рисунок 29 - использование инструмента Erase and Fill

\ |image41|

Рисунок 30 - использование инструмента Erase and Fill

\ |image42|

Рисунок 31 - использование инструмента Erase and Fill

\ |image43|

Рисунок 32 - использование инструмента Erase and Fill

\ |image44|

Рисунок 33 - использование инструмента Erase and Fill

Второй метод отлично работает, когда вы не смогли сфотографировать
какую-либо область объекта, но она может быть достроена по имеющейся
поверхности.

.. |image0| image:: media/image1.jpg
   :width: 5.22352in
   :height: 2.17832in
.. |image1| image:: media/image2.jpg
   :width: 6.49931in
   :height: 3.73611in
.. |image2| image:: media/image3.png
   :width: 2.11978in
   :height: 1.61152in
.. |image3| image:: media/image4.png
   :width: 2.17385in
   :height: 1.57366in
.. |image4| image:: media/image5.jpg
   :width: 6.49931in
   :height: 4.05556in
.. |image5| image:: media/image6.jpg
   :width: 4.54609in
   :height: 1.94833in
.. |image6| image:: media/image7.jpg
   :width: 6.16771in
   :height: 2.67860in
.. |image7| image:: media/image8.jpg
   :width: 6.15674in
   :height: 2.63438in
.. |image8| image:: media/image9.jpg
   :width: 6.07431in
   :height: 3.14152in
.. |image9| image:: media/image3.png
   :width: 2.36327in
   :height: 1.69111in
.. |image10| image:: media/image4.png
   :width: 2.18037in
   :height: 1.63495in
.. |image11| image:: media/image10.png
   :width: 6.49931in
   :height: 4.30556in
.. |image12| image:: media/image11.jpg
   :width: 5.95831in
   :height: 4.24896in
.. |image13| image:: media/image12.png
   :width: 6.49653in
   :height: 4.62500in
.. |image14| image:: media/image13.jpg
   :width: 5.42604in
   :height: 3.48383in
.. |image15| image:: media/image14.png
   :width: 0.19661in
   :height: 0.16771in
.. |image16| image:: media/image15.png
   :width: 0.23611in
   :height: 0.23611in
.. |image17| image:: media/image16.png
   :width: 0.20833in
   :height: 0.20833in
.. |image18| image:: media/image17.png
   :width: 0.22083in
   :height: 0.20833in
.. |image19| image:: media/image17.png
   :width: 0.22083in
   :height: 0.20833in
.. |image20| image:: media/image18.png
   :width: 0.20000in
   :height: 0.20000in
.. |image21| image:: media/image19.png
   :width: 0.17917in
   :height: 0.17500in
.. |image22| image:: media/image20.png
   :width: 0.18611in
   :height: 0.18611in
.. |image23| image:: media/image21.png
   :width: 5.71547in
   :height: 2.43597in
.. |image24| image:: media/image22.png
   :width: 6.07980in
   :height: 3.13437in
.. |image25| image:: media/image23.png
   :width: 6.49931in
   :height: 2.97222in
.. |image26| image:: media/image24.png
   :width: 5.00503in
   :height: 3.53445in
.. |image27| image:: media/image25.png
   :width: 6.49931in
   :height: 3.65278in
.. |image28| image:: media/image26.png
   :width: 6.49931in
   :height: 3.90278in
.. |image29| image:: media/image27.png
   :width: 6.49931in
   :height: 4.38889in
.. |image30| image:: media/image28.png
   :width: 3.07035in
   :height: 3.23561in
.. |image31| image:: media/image29.png
   :width: 5.50077in
   :height: 3.64245in
.. |image32| image:: media/image30.png
   :width: 5.47033in
   :height: 3.59902in
.. |image33| image:: media/image31.png
   :width: 5.41230in
   :height: 3.58387in
.. |image34| image:: media/image32.png
   :width: 2.91186in
   :height: 3.58400in
.. |image35| image:: media/image33.jpg
   :width: 6.24149in
   :height: 3.51979in
.. |image36| image:: media/image34.jpg
   :width: 6.14688in
   :height: 4.38631in
.. |image37| image:: media/image35.jpg
   :width: 6.11987in
   :height: 4.50937in
.. |image38| image:: media/image36.jpg
   :width: 6.49931in
   :height: 4.56944in
.. |image39| image:: media/image37.jpg
   :width: 6.49931in
   :height: 4.37500in
.. |image40| image:: media/image38.jpg
   :width: 6.49931in
   :height: 4.44444in
.. |image41| image:: media/image39.jpg
   :width: 6.49931in
   :height: 4.19444in
.. |image42| image:: media/image40.jpg
   :width: 6.49931in
   :height: 4.22222in
.. |image43| image:: media/image41.jpg
   :width: 6.49931in
   :height: 4.18056in
.. |image44| image:: media/image42.jpg
   :width: 6.49931in
   :height: 4.20833in
